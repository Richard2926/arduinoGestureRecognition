#include <Wire.h>
#include <Adafruit_Sensor.h>
#include <Adafruit_LSM303_U.h>
#include <Adafruit_9DOF.h>
#include <Adafruit_L3GD20_U.h>

Adafruit_9DOF                 dof   = Adafruit_9DOF();
Adafruit_LSM303_Accel_Unified accel = Adafruit_LSM303_Accel_Unified(30301);
Adafruit_LSM303_Mag_Unified   mag   = Adafruit_LSM303_Mag_Unified(30302);

void initSensors()
{
  if (!accel.begin())
  {
    Serial.println(F("Ooops, no LSM303 detected ... Check your wiring!"));
    while (1);
  }
  if (!mag.begin())
  {
    Serial.println("Ooops, no LSM303 detected ... Check your wiring!");
    while (1);
  }
}


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
const int checkEvery = 30;    // (dataPoints-1)/(checkEvery*3) has to be a whole number aka 360/ how often you want to check it (in ms) * 3 because of 3 inputs per 10 ms
const int dataNo = 120;   // Use what you picked in Octave
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



const int dataPoints = dataNo * 3;
const int subInp = (dataPoints / 3);
struct results
{
  double x;
  double y;
  double z;
};

const int noOfLoops = (dataPoints / (checkEvery * 3));

double X[checkEvery];
double Y[checkEvery];
double Z[checkEvery];

double storeX[subInp];
double storeY[subInp];
double storeZ[subInp];

double theta1[(dataPoints + 1)] = { -1.8872
                                   , 0.020466
                                   , 0.028598
                                   , 0.026781
                                   , 0.013963
                                   , 0.024803
                                   , 0.018776
                                   , 0.025968
                                   , 0.027469
                                   , 0.038396
                                   , 0.011033
                                   , -0.0098953
                                   , -0.024216
                                   , -0.036679
                                   , -0.028355
                                   , -0.057014
                                   , -0.080448
                                   , -0.084325
                                   , -0.088466
                                   , -0.092682
                                   , -0.095255
                                   , -0.099678
                                   , -0.10229
                                   , -0.10570
                                   , -0.096803
                                   , -0.096665
                                   , -0.090714
                                   , -0.10631
                                   , -0.10868
                                   , -0.10420
                                   , -0.098222
                                   , -0.086446
                                   , -0.081464
                                   , -0.081798
                                   , -0.086139
                                   , -0.062028
                                   , -0.059163
                                   , -0.053932
                                   , -0.045789
                                   , -0.048864
                                   , -0.044358
                                   , -0.031451
                                   , -0.027719
                                   , -0.034810
                                   , -0.0068209
                                   , -0.029676
                                   , 0.0087678
                                   , -0.042014
                                   , -0.019766
                                   , -0.020925
                                   , -0.045741
                                   , -0.040697
                                   , -0.035660
                                   , -0.022625
                                   , -0.025406
                                   , 0.0030556
                                   , 0.012215
                                   , 0.00087144
                                   , 0.0081479
                                   , 0.012225
                                   , 0.010808
                                   , 0.014715
                                   , 0.0069471
                                   , 0.018340
                                   , 0.017836
                                   , 0.017932
                                   , 0.031731
                                   , 0.032764
                                   , 0.023666
                                   , 0.023506
                                   , 0.022022
                                   , 0.029151
                                   , 0.028109
                                   , 0.020857
                                   , 0.013287
                                   , 0.0098242
                                   , 0.025130
                                   , 0.0017042
                                   , 0.0096966
                                   , -0.0055674
                                   , 0.0046386
                                   , -0.0019509
                                   , -0.042247
                                   , -0.020747
                                   , -0.023824
                                   , -0.019158
                                   , -0.045365
                                   , -0.062091
                                   , -0.039762
                                   , -0.066994
                                   , -0.053584
                                   , -0.048530
                                   , -0.021806
                                   , -0.025054
                                   , -0.029400
                                   , -0.0078819
                                   , -0.0048093
                                   , 0.0079451
                                   , 0.027595
                                   , 0.026349
                                   , 0.017210
                                   , 0.045017
                                   , 0.060836
                                   , 0.052698
                                   , 0.032540
                                   , 0.049442
                                   , 0.056517
                                   , 0.029663
                                   , 0.050375
                                   , 0.058767
                                   , 0.047837
                                   , 0.035720
                                   , 0.065000
                                   , 0.090957
                                   , 0.043923
                                   , 0.057781
                                   , 0.060010
                                   , 0.067335
                                   , 0.063130
                                   , 0.065845
                                   , 0.067342
                                   , -0.073898
                                   , -0.074823
                                   , -0.068428
                                   , -0.035440
                                   , -0.035516
                                   , -0.023779
                                   , -0.033035
                                   , -0.029538
                                   , -0.043355
                                   , -0.086510
                                   , -0.045184
                                   , -0.053184
                                   , -0.039873
                                   , -0.056075
                                   , -0.037921
                                   , -0.038599
                                   , -0.060525
                                   , -0.044464
                                   , -0.075405
                                   , 0.000052608
                                   , -0.072671
                                   , 0.0032319
                                   , 0.0038777
                                   , 0.0094330
                                   , -0.010797
                                   , -0.045869
                                   , 0.033303
                                   , 0.053917
                                   , 0.035982
                                   , 0.031295
                                   , 0.033510
                                   , 0.0046369
                                   , 0.020102
                                   , 0.011708
                                   , 0.023833
                                   , 0.036130
                                   , 0.017746
                                   , 0.015494
                                   , 0.014679
                                   , 0.055544
                                   , 0.090034
                                   , 0.079486
                                   , 0.075771
                                   , 0.047293
                                   , 0.0082737
                                   , 0.039175
                                   , 0.022943
                                   , 0.048019
                                   , 0.057660
                                   , 0.034029
                                   , 0.10443
                                   , 0.095954
                                   , 0.061015
                                   , 0.051601
                                   , 0.047570
                                   , -0.015316
                                   , -0.0088585
                                   , 0.0063906
                                   , 0.0053416
                                   , 0.012716
                                   , 0.017397
                                   , 0.022962
                                   , 0.012449
                                   , 0.0023822
                                   , 0.015583
                                   , 0.0097553
                                   , 0.014611
                                   , -0.0022799
                                   , 0.010286
                                   , 0.019706
                                   , 0.012023
                                   , 0.0058937
                                   , 0.013924
                                   , -0.011926
                                   , 0.0050445
                                   , -0.0040498
                                   , -0.047658
                                   , -0.062687
                                   , -0.050245
                                   , -0.042377
                                   , -0.043351
                                   , -0.045988
                                   , -0.0013084
                                   , 0.0042408
                                   , -0.0022100
                                   , 0.011275
                                   , -0.033650
                                   , 0.015009
                                   , 0.022269
                                   , -0.019605
                                   , -0.045584
                                   , 0.025474
                                   , -0.020235
                                   , -0.032783
                                   , -0.0064374
                                   , -0.058966
                                   , 0.011493
                                   , -0.010344
                                   , -0.045619
                                   , 0.030267
                                   , -0.057388
                                   , -0.038196
                                   , -0.054851
                                   , -0.058730
                                   , -0.057194
                                   , -0.016547
                                   , 0.0022686
                                   , 0.016407
                                   , -0.026635
                                   , -0.054636
                                   , -0.066625
                                   , -0.062769
                                   , -0.070964
                                   , -0.072783
                                   , -0.075146
                                   , -0.026590
                                   , -0.086132
                                   , -0.10018
                                   , -0.089115
                                   , -0.11951
                                   , -0.0052083
                                   , -0.0065672
                                   , -0.0029777
                                   , -0.0022852
                                   , 0.0038511
                                   , 0.00077848
                                   , 0.031689
                                   , 0.0047080
                                   , 0.0060232
                                   , 0.0020042
                                   , 0.00056046
                                   , 0.0085943
                                   , 0.016241
                                   , 0.0057665
                                   , -0.067347
                                   , -0.024367
                                   , -0.041962
                                   , -0.016040
                                   , -0.030038
                                   , -0.023825
                                   , -0.099993
                                   , -0.096862
                                   , -0.068306
                                   , -0.015462
                                   , -0.019569
                                   , -0.029864
                                   , -0.028442
                                   , -0.028920
                                   , -0.045387
                                   , -0.026094
                                   , -0.020214
                                   , 0.0031118
                                   , -0.023835
                                   , -0.025615
                                   , -0.022723
                                   , -0.012496
                                   , -0.0070686
                                   , -0.0032652
                                   , 0.0099526
                                   , 0.011894
                                   , 0.023655
                                   , 0.033781
                                   , 0.046098
                                   , 0.053153
                                   , 0.055577
                                   , 0.060112
                                   , 0.080629
                                   , 0.063045
                                   , 0.0091330
                                   , 0.015847
                                   , 0.022661
                                   , -0.011384
                                   , 0.0013754
                                   , 0.0086679
                                   , 0.010177
                                   , 0.0089783
                                   , 0.0076352
                                   , 0.010454
                                   , -0.024963
                                   , 0.0049592
                                   , 0.0062988
                                   , 0.011740
                                   , 0.0036747
                                   , -0.0028661
                                   , 0.00024494
                                   , -0.026776
                                   , 0.011324
                                   , 0.034006
                                   , 0.022566
                                   , 0.022377
                                   , 0.012987
                                   , 0.011361
                                   , 0.014373
                                   , 0.0091830
                                   , 0.012375
                                   , -0.0072510
                                   , -0.024902
                                   , 0.0084838
                                   , 0.00020741
                                   , 0.042336
                                   , 0.035728
                                   , 0.034333
                                   , 0.0092293
                                   , 0.010949
                                   , -0.0086469
                                   , -0.0053090
                                   , -0.0083688
                                   , -0.0016467
                                   , -0.011899
                                   , -0.058975
                                   , -0.057684
                                   , -0.044221
                                   , -0.044939
                                   , -0.040421
                                   , -0.046976
                                   , -0.039813
                                   , -0.028333
                                   , -0.010760
                                   , -0.017550
                                   , -0.0051122
                                   , -0.0026134
                                   , 0.0085257
                                   , 0.010968
                                   , -0.025041
                                   , -0.023030
                                   , -0.0087131
                                   , -0.016468
                                   , -0.014616
                                   , -0.018001
                                   , -0.016490
                                   , -0.015529
                                   , -0.018991
                                   , -0.021536
                                   , -0.017945
                                   , -0.010781
                                   , 0.033364
                                   , 0.029442
                                   , 0.031750
                                   , 0.018323
                                   , 0.036198
                                 } ;
double theta2[(dataPoints + 1)] = { -1.4162
                                   , -0.10885
                                   , -0.11905
                                   , -0.13246
                                   , -0.10195
                                   , -0.12624
                                   , -0.10796
                                   , -0.11219
                                   , -0.11268
                                   , -0.14450
                                   , -0.10829
                                   , -0.099491
                                   , -0.077212
                                   , -0.052395
                                   , -0.063325
                                   , -0.040324
                                   , -0.017787
                                   , 0.0012359
                                   , 0.0025197
                                   , 0.012918
                                   , 0.018059
                                   , 0.025854
                                   , 0.0073738
                                   , 0.031055
                                   , 0.016307
                                   , 0.042004
                                   , 0.046688
                                   , 0.053517
                                   , 0.060108
                                   , 0.055798
                                   , 0.051398
                                   , 0.036704
                                   , 0.032891
                                   , 0.041338
                                   , 0.038754
                                   , 0.052805
                                   , 0.062661
                                   , 0.046441
                                   , 0.051912
                                   , 0.025537
                                   , 0.025933
                                   , 0.048611
                                   , 0.038111
                                   , 0.036138
                                   , 0.039129
                                   , 0.043006
                                   , 0.037885
                                   , 0.10117
                                   , 0.026441
                                   , 0.035120
                                   , 0.066328
                                   , 0.079018
                                   , 0.060302
                                   , 0.040772
                                   , 0.0019865
                                   , -0.021679
                                   , -0.032431
                                   , -0.031542
                                   , -0.038803
                                   , -0.028107
                                   , -0.031147
                                   , -0.024632
                                   , 0.0018388
                                   , -0.010607
                                   , -0.012009
                                   , 0.00025390
                                   , -0.016047
                                   , 0.0011391
                                   , -0.0081518
                                   , 0.0067979
                                   , -0.0065919
                                   , -0.0068153
                                   , 0.0037231
                                   , 0.0065686
                                   , -0.0071221
                                   , 0.010394
                                   , -0.0069028
                                   , -0.0028297
                                   , 0.0011878
                                   , 0.0059232
                                   , -0.0068851
                                   , 0.013635
                                   , 0.034426
                                   , 0.019730
                                   , 0.011095
                                   , 0.016856
                                   , 0.039782
                                   , 0.050757
                                   , 0.039961
                                   , 0.065676
                                   , 0.057380
                                   , 0.046251
                                   , 0.027489
                                   , 0.019775
                                   , 0.024078
                                   , -0.013314
                                   , -0.0065743
                                   , -0.015910
                                   , -0.022917
                                   , -0.014183
                                   , 0.0050016
                                   , -0.011278
                                   , -0.0099354
                                   , 0.025697
                                   , 0.031898
                                   , 0.026265
                                   , -0.0027493
                                   , 0.025130
                                   , 0.0045698
                                   , -0.0093588
                                   , 0.0034029
                                   , 0.016625
                                   , -0.012369
                                   , -0.044203
                                   , -0.00088107
                                   , -0.024389
                                   , -0.026302
                                   , -0.044608
                                   , -0.034001
                                   , -0.029926
                                   , -0.023335
                                   , 0.028125
                                   , 0.030219
                                   , 0.026458
                                   , 0.026023
                                   , 0.019512
                                   , 0.023304
                                   , 0.029362
                                   , 0.015957
                                   , 0.060468
                                   , 0.073055
                                   , 0.065104
                                   , 0.061526
                                   , 0.049980
                                   , 0.066065
                                   , 0.059177
                                   , 0.058759
                                   , 0.051451
                                   , 0.011882
                                   , 0.047780
                                   , 0.0073146
                                   , 0.027937
                                   , 0.018197
                                   , -0.016445
                                   , -0.0072849
                                   , -0.0053750
                                   , -0.021532
                                   , -0.080471
                                   , -0.089575
                                   , -0.11085
                                   , -0.11477
                                   , -0.12761
                                   , -0.11107
                                   , -0.11130
                                   , -0.092185
                                   , -0.11200
                                   , -0.056683
                                   , -0.036049
                                   , -0.035325
                                   , -0.020814
                                   , -0.040513
                                   , -0.13907
                                   , -0.14114
                                   , -0.11673
                                   , -0.039618
                                   , -0.10962
                                   , -0.083356
                                   , -0.021400
                                   , -0.10099
                                   , -0.052747
                                   , -0.026381
                                   , -0.12406
                                   , -0.10184
                                   , -0.016685
                                   , -0.067818
                                   , -0.13527
                                   , 0.021139
                                   , 0.015781
                                   , -0.021811
                                   , -0.010745
                                   , -0.040614
                                   , -0.038749
                                   , -0.025741
                                   , -0.043594
                                   , -0.0057649
                                   , -0.046184
                                   , -0.024412
                                   , -0.049569
                                   , -0.033696
                                   , -0.027495
                                   , -0.020991
                                   , -0.027865
                                   , -0.014579
                                   , -0.013931
                                   , 0.066891
                                   , 0.020824
                                   , 0.026402
                                   , 0.031394
                                   , 0.029414
                                   , 0.076538
                                   , 0.073942
                                   , 0.043175
                                   , 0.032683
                                   , -0.00032163
                                   , 0.022074
                                   , 0.035197
                                   , -0.0053059
                                   , 0.048325
                                   , 0.0047551
                                   , -0.0026561
                                   , 0.046456
                                   , 0.039505
                                   , 0.010201
                                   , -0.048741
                                   , -0.013977
                                   , -0.014316
                                   , 0.066812
                                   , -0.015947
                                   , 0.0046302
                                   , 0.048704
                                   , -0.072514
                                   , 0.081181
                                   , 0.012175
                                   , 0.064222
                                   , 0.069537
                                   , 0.070245
                                   , -0.012773
                                   , -0.0041184
                                   , -0.054417
                                   , 0.035469
                                   , 0.060691
                                   , 0.056169
                                   , 0.049029
                                   , 0.043500
                                   , 0.057979
                                   , 0.083531
                                   , 0.0010233
                                   , 0.067013
                                   , 0.040503
                                   , 0.037837
                                   , 0.13211
                                   , 0.021901
                                   , 0.021849
                                   , 0.013687
                                   , 0.014329
                                   , 0.015224
                                   , 0.012078
                                   , 0.014147
                                   , 0.0086951
                                   , 0.014515
                                   , 0.014168
                                   , 0.017345
                                   , -0.0055347
                                   , -0.010641
                                   , 0.0018136
                                   , 0.074001
                                   , 0.044778
                                   , 0.071214
                                   , -0.00023836
                                   , 0.015204
                                   , 0.021061
                                   , 0.059525
                                   , 0.058838
                                   , 0.051672
                                   , -0.0019976
                                   , 0.0055408
                                   , 0.016592
                                   , 0.011015
                                   , 0.0085091
                                   , 0.0066930
                                   , 0.0092769
                                   , 0.010344
                                   , -0.0090739
                                   , 0.0062787
                                   , 0.014802
                                   , 0.010427
                                   , 0.0097795
                                   , 0.0072278
                                   , 0.012380
                                   , 0.00028448
                                   , 0.0058591
                                   , -0.00089599
                                   , -0.0084455
                                   , -0.014782
                                   , -0.016555
                                   , -0.0087145
                                   , -0.0049224
                                   , -0.046211
                                   , -0.028260
                                   , 0.011956
                                   , -0.00092117
                                   , -0.00031796
                                   , 0.042816
                                   , 0.030772
                                   , 0.032996
                                   , 0.032167
                                   , -0.0031204
                                   , -0.017196
                                   , -0.015527
                                   , 0.026771
                                   , -0.0086330
                                   , -0.0094597
                                   , -0.0085922
                                   , 0.0083548
                                   , 0.022312
                                   , 0.014505
                                   , 0.029128
                                   , 0.018343
                                   , 0.0080183
                                   , -0.027027
                                   , 0.0058696
                                   , -0.0052477
                                   , -0.014226
                                   , -0.015161
                                   , -0.019380
                                   , -0.018889
                                   , -0.0066903
                                   , 0.0065675
                                   , -0.042881
                                   , -0.039930
                                   , -0.049925
                                   , -0.045452
                                   , -0.022187
                                   , -0.024101
                                   , -0.021168
                                   , -0.0012237
                                   , -0.013302
                                   , -0.010120
                                   , -0.026559
                                   , -0.0098966
                                   , 0.026696
                                   , 0.026157
                                   , -0.050420
                                   , -0.00078976
                                   , 0.0040459
                                   , -0.016300
                                   , -0.023615
                                   , -0.025144
                                   , -0.052739
                                   , -0.044743
                                   , -0.041346
                                   , -0.044920
                                   , 0.0013440
                                   , -0.0048065
                                   , 0.033248
                                   , 0.031219
                                   , 0.023413
                                   , 0.024879
                                   , 0.023618
                                   , 0.035953
                                   , 0.027340
                                   , 0.031192
                                   , 0.034628
                                   , 0.036813
                                   , 0.010478
                                   , 0.014542
                                   , -0.059069
                                   , -0.051188
                                   , -0.049863
                                   , -0.029095
                                   , -0.048966
                                 } ;
double theta3[(dataPoints + 1)] = { -2.1280
                                   , 0.088925
                                   , 0.088703
                                   , 0.091977
                                   , 0.084361
                                   , 0.091131
                                   , 0.087936
                                   , 0.090971
                                   , 0.086339
                                   , 0.095333
                                   , 0.086788
                                   , 0.090877
                                   , 0.087433
                                   , 0.080911
                                   , 0.082679
                                   , 0.083316
                                   , 0.081869
                                   , 0.072901
                                   , 0.071766
                                   , 0.067335
                                   , 0.064859
                                   , 0.060475
                                   , 0.067771
                                   , 0.057993
                                   , 0.061285
                                   , 0.056222
                                   , 0.050237
                                   , 0.054298
                                   , 0.036231
                                   , 0.042442
                                   , 0.033234
                                   , 0.036166
                                   , 0.027929
                                   , 0.024471
                                   , 0.023005
                                   , 0.0094658
                                   , 0.0011602
                                   , 0.0033187
                                   , -0.0055276
                                   , -0.00036457
                                   , -0.0049700
                                   , -0.019224
                                   , -0.016630
                                   , -0.0073789
                                   , -0.015606
                                   , -0.018671
                                   , -0.021080
                                   , -0.049879
                                   , -0.022301
                                   , -0.024594
                                   , -0.028518
                                   , -0.033020
                                   , -0.031149
                                   , -0.027150
                                   , -0.0026368
                                   , 0.00066941
                                   , 0.0036107
                                   , 0.012079
                                   , 0.0063434
                                   , -0.0030753
                                   , 0.0016511
                                   , -0.0026539
                                   , -0.011045
                                   , -0.011182
                                   , -0.011182
                                   , -0.010652
                                   , -0.012541
                                   , -0.018278
                                   , -0.014682
                                   , -0.019924
                                   , -0.010416
                                   , -0.010736
                                   , -0.015344
                                   , -0.011699
                                   , -0.0070000
                                   , -0.0086711
                                   , -0.0027459
                                   , -0.0056039
                                   , -0.011895
                                   , -0.0044720
                                   , -0.0026218
                                   , -0.015828
                                   , -0.0080366
                                   , -0.0059697
                                   , 0.0079918
                                   , -0.00094348
                                   , -0.0063153
                                   , 0.0016298
                                   , 0.000061047
                                   , -0.0076562
                                   , -0.0058429
                                   , -0.0078417
                                   , -0.0067246
                                   , -0.0052034
                                   , -0.0050482
                                   , -0.0011139
                                   , -0.0085919
                                   , -0.010725
                                   , -0.011343
                                   , -0.016059
                                   , -0.021622
                                   , -0.026261
                                   , -0.041270
                                   , -0.061778
                                   , -0.046137
                                   , -0.056878
                                   , -0.042148
                                   , -0.044810
                                   , -0.043509
                                   , -0.039596
                                   , -0.042644
                                   , -0.043659
                                   , -0.040652
                                   , -0.034614
                                   , -0.034034
                                   , -0.032453
                                   , -0.033918
                                   , -0.024799
                                   , -0.031396
                                   , -0.032699
                                   , -0.034923
                                   , 0.036526
                                   , 0.035468
                                   , 0.035152
                                   , 0.013875
                                   , 0.017926
                                   , 0.013765
                                   , 0.013662
                                   , 0.018003
                                   , 0.0010236
                                   , 0.019704
                                   , -0.00032611
                                   , 0.0029497
                                   , 0.0073985
                                   , 0.0060031
                                   , 0.0039710
                                   , 0.0075290
                                   , 0.024696
                                   , 0.040849
                                   , 0.028056
                                   , 0.011664
                                   , 0.039653
                                   , 0.012299
                                   , 0.031490
                                   , 0.026429
                                   , 0.028612
                                   , 0.036284
                                   , 0.041172
                                   , 0.042108
                                   , 0.070206
                                   , 0.080064
                                   , 0.10171
                                   , 0.098210
                                   , 0.071765
                                   , 0.057876
                                   , 0.076237
                                   , 0.030069
                                   , 0.023940
                                   , 0.023748
                                   , 0.020718
                                   , 0.014954
                                   , 0.053631
                                   , 0.052912
                                   , 0.047459
                                   , 0.015824
                                   , 0.064100
                                   , 0.037006
                                   , 0.014347
                                   , 0.046225
                                   , 0.0070287
                                   , 0.0040466
                                   , 0.015815
                                   , 0.0054347
                                   , -0.016842
                                   , 0.017633
                                   , 0.055028
                                   , 0.0078450
                                   , 0.010304
                                   , 0.032088
                                   , 0.030121
                                   , 0.030687
                                   , 0.029971
                                   , 0.021614
                                   , 0.031245
                                   , 0.020113
                                   , 0.028359
                                   , 0.023552
                                   , 0.042161
                                   , 0.040888
                                   , 0.036382
                                   , 0.017273
                                   , 0.029014
                                   , 0.027589
                                   , 0.025607
                                   , -0.011857
                                   , 0.0083534
                                   , -0.0083261
                                   , 0.015069
                                   , 0.024051
                                   , -0.022207
                                   , -0.021592
                                   , -0.0019172
                                   , 0.013737
                                   , -0.0092666
                                   , -0.019119
                                   , -0.018909
                                   , -0.0079192
                                   , -0.0095466
                                   , -0.019955
                                   , -0.020890
                                   , -0.020430
                                   , -0.0091919
                                   , -0.018127
                                   , 0.035478
                                   , 0.025264
                                   , 0.022648
                                   , 0.00089890
                                   , 0.0047793
                                   , 0.0055635
                                   , 0.0091809
                                   , 0.025711
                                   , 0.0024792
                                   , 0.027003
                                   , 0.010185
                                   , 0.0066632
                                   , 0.0068447
                                   , 0.024098
                                   , 0.0068401
                                   , 0.026960
                                   , -0.0023803
                                   , 0.0040704
                                   , 0.010943
                                   , 0.011415
                                   , 0.023667
                                   , 0.020027
                                   , 0.0060432
                                   , 0.024354
                                   , 0.022079
                                   , 0.048294
                                   , 0.044486
                                   , 0.0075210
                                   , 0.010817
                                   , 0.011591
                                   , 0.011302
                                   , 0.010032
                                   , 0.0046757
                                   , 0.0096867
                                   , 0.0093469
                                   , 0.0099459
                                   , 0.0022116
                                   , 0.0078943
                                   , 0.0079247
                                   , 0.0098540
                                   , 0.0093335
                                   , 0.0066813
                                   , -0.0056743
                                   , -0.0013758
                                   , -0.0023832
                                   , 0.025750
                                   , 0.022827
                                   , 0.016360
                                   , 0.037113
                                   , 0.036140
                                   , 0.027512
                                   , 0.027625
                                   , 0.021746
                                   , 0.012546
                                   , 0.015060
                                   , 0.013777
                                   , 0.040432
                                   , 0.0060430
                                   , 0.0026911
                                   , -0.0042454
                                   , -0.0076958
                                   , -0.016266
                                   , -0.016664
                                   , -0.024686
                                   , -0.026440
                                   , -0.032670
                                   , -0.033684
                                   , -0.038960
                                   , -0.040642
                                   , -0.042802
                                   , -0.046042
                                   , -0.048209
                                   , -0.054437
                                   , -0.057338
                                   , -0.040492
                                   , -0.038283
                                   , -0.043393
                                   , -0.031303
                                   , -0.036819
                                   , -0.041836
                                   , -0.043137
                                   , -0.047338
                                   , -0.048614
                                   , -0.026696
                                   , -0.0019588
                                   , -0.0042467
                                   , -0.0059346
                                   , -0.0089478
                                   , -0.010912
                                   , -0.015799
                                   , -0.018076
                                   , -0.022836
                                   , -0.020548
                                   , -0.018732
                                   , -0.019581
                                   , -0.021824
                                   , 0.0040923
                                   , -0.013167
                                   , -0.0035254
                                   , 0.0079812
                                   , 0.0064667
                                   , 0.017571
                                   , 0.015557
                                   , 0.0073244
                                   , 0.014754
                                   , 0.030623
                                   , 0.030262
                                   , 0.013295
                                   , 0.017242
                                   , -0.013438
                                   , 0.015463
                                   , 0.0099786
                                   , 0.010005
                                   , 0.015438
                                   , 0.015164
                                   , 0.020253
                                   , 0.015778
                                   , 0.018114
                                   , 0.018591
                                   , 0.041203
                                   , 0.022427
                                   , 0.021812
                                   , 0.052167
                                   , 0.052216
                                   , 0.041293
                                   , 0.043702
                                   , 0.053115
                                   , 0.027577
                                   , 0.027710
                                   , -0.010995
                                   , -0.0084164
                                   , -0.0085661
                                   , -0.0092317
                                   , -0.011482
                                   , -0.0073158
                                   , -0.0075028
                                   , -0.0078011
                                   , -0.0080279
                                   , -0.0087551
                                   , -0.0088929
                                   , -0.0097804
                                   , -0.0021584
                                   , -0.0082323
                                   , 0.019134
                                   , 0.016915
                                   , 0.017073
                                   , 0.016421
                                   , 0.017615
                                 } ;

results ans;
results gest; // change or create new struct if you trained more gestures

double key[(1 + dataPoints)];

void setup(void)
{
  Serial.begin(9600);
  initSensors();
  delay(2000);
  key[1] = 1;  // Bias Weight
  Serial.println(key[1]);
  Serial.println(theta1[2]);
  Serial.println(theta1[3]);
}

void loop(void)
{
  for (int i = 1; i <= checkEvery; i++) {

    data();
    X[i] = ans.x;
    Y[i] = ans.y;
    Z[i] = ans.z;
    delay(10);
  }

  for (int i = 0; i < (noOfLoops - 1); i++) {

    for (int j = (1 + checkEvery * i); j <= (checkEvery * (i + 1)); j++) {

      storeX[j] = storeX[(j + checkEvery)];
      storeY[j] = storeX[(j + checkEvery)];
      storeZ[j] = storeX[(j + checkEvery)];
    }

  }


  for ( int i = (1 + ((noOfLoops - 1) * checkEvery)); i <= (checkEvery * 3); i++) {

    storeX[i] = X[(i - ((noOfLoops - 1) * checkEvery)) ];
    storeY[i] = Y[(i - ((noOfLoops - 1) * checkEvery)) ];
    storeZ[i] = Z[(i - ((noOfLoops - 1) * checkEvery)) ];

  }

  for (int i = 2 ; i <= (subInp + 1); i++) {

    key[i] = storeX[(i - 1)];
    key[(i + subInp)] = storeY[(i - 1)];
    key[(i + subInp * 2)] = storeZ[(i - 1)];

  }

  gest.x = 0;
  gest.y = 0;
  gest.z = 0;


  for (int i = 1; i <= (1 + dataPoints); i++) {

    gest.x += theta1[i] * key[i];
    gest.y += theta2[i] * key[i];
    gest.z += theta3[i] * key[i];
  }

  gest.x = 1 / (1 + exp(-gest.x));
  gest.y = 1 / (1 + exp(-gest.y));
  gest.z = 1 / (1 + exp(-gest.z));

/*Serial.println(gest.x);
Serial.println(gest.y);
Serial.println(gest.z);*/

  if ((gest.x > gest.y) && (gest.x > gest.z)) {

    Serial.println(" Do something");


  }
  if ((gest.y > gest.x) && (gest.y > gest.z)) {

    Serial.println("Unlock");

  }
  if ((gest.z > gest.x) && (gest.z > gest.y)) {

    Serial.println("Rotate");

  }
}

int data() {
  sensors_event_t accel_event;
  sensors_event_t mag_event;
  sensors_vec_t   orientation;

  accel.getEvent(&accel_event);
  mag.getEvent(&mag_event);

  if (dof.fusionGetOrientation(&accel_event, &mag_event, &orientation))
  {


    ans.x = orientation.roll;
    ans.y = orientation.pitch;
    ans.z = orientation.heading;
  }

}
